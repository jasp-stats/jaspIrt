context("[IRT] Dichotomous Item Response Theory")

options("jaspRoundToPrecision" = function(x) signif(round(x, digits = 2), digits = 2))

# Consistency test 1, file: binary.csv, model: Rasch ###########################

options <- initIRTOptions("itemResponseTheoryDichotomous")
options$explanatoryText <- FALSE
options$emTolerance <- 0.0001
options$tableFitStatistics <- TRUE
options$tableFitStatisticsCI <- 0.95
options$tableItemStatistics <- TRUE
options$tableParameterEstimates <- FALSE
options$plotHistogramAbility <- TRUE
options$plotTestInformation <- TRUE
options$plotItemInformationItems <- c("Q1", "Q2", "Q3", "Q4", "Q5", "Q6", "Q7", "Q8", "Q9", "Q10", "Q11", "Q12", "Q13", "Q14", "Q15", "Q16", "Q17", "Q18", "Q19", "Q20", "Q21", "Q22", "Q23", "Q24", "Q25", "Q26", "Q27", "Q28", "Q29", "Q30", "Q31", "Q32", "Q33", "Q34", "Q35", "Q36", "Q37", "Q38", "Q39", "Q40", "Q41", "Q42", "Q43")
options$plotItemInformationLabels <- FALSE
options$plotItemCharacteristicItems <- c("Q1", "Q2", "Q3", "Q4", "Q5", "Q6", "Q7", "Q8", "Q9", "Q10", "Q11", "Q12", "Q13", "Q14", "Q15", "Q16", "Q17", "Q18", "Q19", "Q20", "Q21", "Q22", "Q23", "Q24", "Q25", "Q26", "Q27", "Q28", "Q29", "Q30", "Q31", "Q32", "Q33", "Q34", "Q35", "Q36", "Q37", "Q38", "Q39", "Q40", "Q41", "Q42", "Q43")
options$plotItemCharacteristicGroup <- TRUE
options$plotItemCharacteristicLabels <- FALSE
options$plotPriorPosterior <- FALSE
options$plotPriorPosteriorLabels <- FALSE
options$model <- "Rasch"
options$items <- c("Q1", "Q2", "Q3", "Q4", "Q5", "Q6", "Q7", "Q8", "Q9", "Q10", "Q11", "Q12", "Q13", "Q14", "Q15", "Q16", "Q17", "Q18", "Q19", "Q20", "Q21", "Q22", "Q23", "Q24", "Q25", "Q26", "Q27", "Q28", "Q29", "Q30", "Q31", "Q32", "Q33", "Q34", "Q35", "Q36", "Q37", "Q38", "Q39", "Q40", "Q41", "Q42", "Q43")
options$covariates <- list()
options$seed <- 1
options$emIterations <- 2000
set.seed(1)
results <- runAnalysis("itemResponseTheoryDichotomous", "binary.csv", options)

test_that("Additional Fit Statistics table results match", {
  table <- results[["results"]][["tableFitStatistics"]][["data"]]
  jaspTools::expect_equal_tables(
    table,
    list(1, 0, 0, 0.0977698280644523, 1.01113878082999, 0.0264468427656401)
  )
})

test_that("Item Information table results match", {
  table <- results[["results"]][["tableItemStatistics"]][["data"]]
  jaspTools::expect_equal_tables(
    table,
    list(
      -0.834434073872999, 12, "Q1", 0.131346950111697, 0.0684593151005349,
      17.5115331210644, 0.472842027811975, 13, "Q2", 0.244375888174004,
      0.0492379192464717, 16.0886508092539, -0.673804971788494, 11,
      "Q3", 0.899151671871884, 0, 5.59204939799097, -1.79304165479512,
      8, "Q4", 0.0675293124703026, 0.0917125613205925, 14.594376020723,
      0.893037162215895, 13, "Q5", 0.957373053968749, 0, 5.66904904949569,
      -0.217791717718766, 11, "Q6", 0.580850919876706, 0, 9.4454058768021,
      -0.945205805720292, 12, "Q7", 0.0818651891448272, 0.0787098516725458,
      19.2856031223695, -0.726696001959351, 12, "Q8", 0.638856740695619,
      0, 9.73887716023927, -0.11941048401731, 12, "Q9", 0.482974509074315,
      0, 11.5438285510247, -0.780218867473198, 12, "Q10", 0.169354081081521,
      0.0618653790301338, 16.5009343441095, 0.0275098943212374, 12,
      "Q11", 0.512217267939751, 0, 11.1958012185669, -0.0703867743927376,
      12, "Q12", 0.347510340642114, 0.033267775881718, 13.3015320166487,
      -1.43206135078338, 11, "Q13", 0.232381391515707, 0.0528507593590735,
      14.0110725804875, -1.17828423047819, 11, "Q14", 0.840640035705377,
      0, 6.46458040388636, -1.79304165479512, 8, "Q15", 0.270688551644551,
      0.0494866774690855, 9.91996209759257, -1.56942488636558, 10,
      "Q16", 0.390902083041485, 0.0243937131622521, 10.5831521770054,
      -0.0214254214535426, 12, "Q17", 0.140396832119659, 0.066821699057376,
      17.2510040107395, -0.51837211500144, 11, "Q18", 0.611242648845317,
      0, 9.11538396852314, -0.0703867743927374, 12, "Q19", 0.799139466311313,
      0, 7.81861558084098, 0.372403588716165, 14, "Q20", 0.535350531022699,
      0, 12.8881327886502, 0.0275098943212377, 12, "Q21", 0.366135854536571,
      0.0297389104548959, 13.0400576869721, -0.26722387347663, 11,
      "Q22", 0.214065431735396, 0.0557719526889388, 14.3531305418627,
      -0.0703867743927373, 12, "Q23", 0.200245147963031, 0.0568954458850254,
      15.8068199126481, 0.678437972987863, 12, "Q24", 0.297572574188103,
      0.0417442568479628, 14.0492775842315, -1.23949447704724, 11,
      "Q25", 0.00654670873190205, 0.117860346737144, 25.9745641169737,
      -0.366763554711419, 12, "Q26", 0.640098842873067, 0, 9.7246935605217,
      -0.217791717718766, 11, "Q27", 0.18746467772643, 0.0600914905450728,
      14.892644240331, 0.0764554044714768, 13, "Q28", 0.203331369608454,
      0.055417485809284, 16.9125785123799, 0.076455404471477, 13,
      "Q29", 0.537370052615591, 0, 11.8816698507098, 1.30329778490818,
      10, "Q30", 0.548809571258055, 0, 8.82477976744492, 0.372403588716165,
      14, "Q31", 0.432092411793239, 0.0131867219398471, 14.2385765799319,
      0.731103734348137, 12, "Q32", 0.203932947218871, 0.0563160921638823,
      15.7296866302544, -0.217791717718766, 11, "Q33", 0.27849757262714,
      0.0454922970830427, 13.2309739232154, -0.673804971788494, 11,
      "Q34", 0.177964238309693, 0.0616712664471885, 15.1000060234057,
      -0.168533128373968, 12, "Q35", 0.220545151763845, 0.0537294967556488,
      15.3949459742196, -0.26722387347663, 11, "Q36", 0.743663330052162,
      0, 7.65695972303869, -1.17828423047819, 11, "Q37", 0.0625671605599687,
      0.0857076673677729, 18.9187769767835, -1.00190754050516, 11,
      "Q38", 0.588826125542974, 0, 9.35863021698523, -1.95721889185563,
      7, "Q39", 0.56043028428287, 0, 5.82411516098281, 2.22937019158486,
      7, "Q40", 0.207621196292042, 0.062470007384741, 9.67711625033762,
      1.87053691273552, 8, "Q41", 0.0151736360165544, 0.118137492799086,
      18.9418702886055, 0.893037162215896, 13, "Q42", 0.310761865295477,
      0.0390787632212585, 14.9455887622667, 0.322619325547928, 14,
      "Q43", 0.314596162940145, 0.0379889571489519, 15.9800167071434
    )
  )
})

test_that("Model Summary table results match", {
  table <- results[["results"]][["tableSummary"]][["data"]]
  jaspTools::expect_equal_tables(
    table,
    list(
      4940.1050143214, 5054.29028772732, 902, 43, 877.660566755698,
      99, 0.713130738291222
    )
  )
})

# Consistency test 2, file: binary2.csv, model: Rasch ##########################

options <- initIRTOptions("itemResponseTheoryDichotomous")
options$explanatoryText <- FALSE
options$emTolerance <- 0.0001
options$tableFitStatistics <- TRUE
options$tableFitStatisticsCI <- 0.95
options$tableItemStatistics <- TRUE
options$tableParameterEstimates <- FALSE
options$plotHistogramAbility <- TRUE
options$plotTestInformation <- TRUE
options$plotItemInformationItems <- c("Q1", "Q2", "Q3", "Q4", "Q5", "Q6", "Q7", "Q8", "Q9", "Q10", "Q11", "Q12", "Q13", "Q14", "Q15", "Q16", "Q17", "Q18", "Q19", "Q20")
options$plotItemInformationLabels <- FALSE
options$plotItemCharacteristicItems <- c("Q1", "Q2", "Q3", "Q4", "Q5", "Q6", "Q7", "Q8", "Q9", "Q10", "Q11", "Q12", "Q13", "Q14", "Q15", "Q16", "Q17", "Q18", "Q19", "Q20")
options$plotItemCharacteristicGroup <- TRUE
options$plotItemCharacteristicLabels <- FALSE
options$plotPriorPosterior <- FALSE
options$plotPriorPosteriorLabels <- FALSE
options$model <- "Rasch"
options$items <- c("Q1", "Q2", "Q3", "Q4", "Q5", "Q6", "Q7", "Q8", "Q9", "Q10", "Q11", "Q12", "Q13", "Q14", "Q15", "Q16", "Q17", "Q18", "Q19", "Q20")
options$covariates <- list()
options$seed <- 1
options$emIterations <- 2000
set.seed(1)
results <- runAnalysis("itemResponseTheoryDichotomous", "binary2.csv", options)

test_that("Additional Fit Statistics table results match", {
  table <- results[["results"]][["tableFitStatistics"]][["data"]]
  jaspTools::expect_equal_tables(
    table,
    list(
      0.945363838260305, 0, 0.0258977161536558, 0.141958062563401, 0.94507475803946,
      0.0736576903314854
    )
  )
})

test_that("Item Information table results match", {
  table <- results[["results"]][["tableItemStatistics"]][["data"]]
  jaspTools::expect_equal_tables(
    table,
    list(
      -1.55622367712289, 4, "Q1", 0.456465272966266, 0, 3.64303504642722,
      -0.272862599296194, 6, "Q2", 0.622022085753047, 0, 4.40515951570346,
      0.275421533609125, 7, "Q3", 0.360821391358412, 0.0448166608066328,
      7.68892684844887, 0.183632980721319, 7, "Q4", 0.299157198785312,
      0.0637446722122645, 8.39374044975902, -0.272862599296194, 6,
      "Q5", 0.170254059761099, 0.102013674877915, 9.0595962194565,
      -1.06664950782117, 4, "Q6", 0.0292260463039458, 0.185905180845386,
      10.7739043079705, -0.180999228371791, 6, "Q7", 0.0208344763037508,
      0.174249695758816, 14.9267092027797, 1.1804616485405, 5, "Q8",
      0.545984763104602, 0, 4.02386746233281, -2.43115751603313, 1,
      "Q9", 0.673264698382824, 0, 0.177806982470461, 0.653676851340574,
      6, "Q10", 0.100995556421825, 0.125301951136958, 10.6159702138662,
      -0.459378454214885, 7, "Q11", 0.150657085060883, 0.104335314917634,
      10.7338492730639, 0.183632980721319, 7, "Q12", 0.460869865945371,
      0, 6.69907513318485, 0.653676851340574, 6, "Q13", 0.0287691353017918,
      0.165766763663289, 14.0787142610078, -0.554647154864627, 7,
      "Q14", 0.438973500480626, 0, 6.90371491407026, -1.29844611084437,
      4, "Q15", 0.278149125794682, 0.0745865816111932, 5.09037899866286,
      -0.75096697186303, 7, "Q16", 0.342599409055535, 0.0508732200312812,
      7.88771298910844, 0.752709240899193, 6, "Q17", 0.151926075979152,
      0.107656873163745, 9.40746068778205, 0.00134683289351775, 7,
      "Q18", 0.882602944311995, 0, 3.02582526490384, -0.459378454214885,
      7, "Q19", 0.37445493658005, 0.0398468731392934, 7.54460624154978,
      -0.459378454214885, 7, "Q20", 0.404527654594333, 0.0263413729899797,
      7.23799670033205
    )
  )
})

test_that("Model Summary table results match", {
  table <- results[["results"]][["tableSummary"]][["data"]]
  jaspTools::expect_equal_tables(
    table,
    list(
      1252.53087257793, 1292.68335569192, 189, 20, 195.211275851993,
      50, 0.363077453087625
    )
  )
})

# Consistency test 3, file: binary.csv, model: 2pl #############################

options <- initIRTOptions("itemResponseTheoryDichotomous")
options$explanatoryText <- FALSE
options$emTolerance <- 0.0001
options$tableFitStatistics <- TRUE
options$tableFitStatisticsCI <- 0.95
options$tableItemStatistics <- TRUE
options$tableParameterEstimates <- FALSE
options$plotHistogramAbility <- TRUE
options$plotTestInformation <- TRUE
options$plotItemInformationItems <- c("Q1", "Q2", "Q3", "Q4", "Q5", "Q6", "Q7", "Q8", "Q9", "Q10", "Q11", "Q12", "Q13", "Q14", "Q15", "Q16", "Q17", "Q18", "Q19", "Q20", "Q21", "Q22", "Q23", "Q24", "Q25", "Q26", "Q27", "Q28", "Q29", "Q30", "Q31", "Q32", "Q33", "Q34", "Q35", "Q36", "Q37", "Q38", "Q39", "Q40", "Q41", "Q42", "Q43")
options$plotItemInformationLabels <- FALSE
options$plotItemCharacteristicItems <- c("Q1", "Q2", "Q3", "Q4", "Q5", "Q6", "Q7", "Q8", "Q9", "Q10", "Q11", "Q12", "Q13", "Q14", "Q15", "Q16", "Q17", "Q18", "Q19", "Q20", "Q21", "Q22", "Q23", "Q24", "Q25", "Q26", "Q27", "Q28", "Q29", "Q30", "Q31", "Q32", "Q33", "Q34", "Q35", "Q36", "Q37", "Q38", "Q39", "Q40", "Q41", "Q42", "Q43")
options$plotItemCharacteristicGroup <- TRUE
options$plotItemCharacteristicLabels <- FALSE
options$plotPriorPosterior <- FALSE
options$plotPriorPosteriorLabels <- FALSE
options$model <- "2PL"
options$items <- c("Q1", "Q2", "Q3", "Q4", "Q5", "Q6", "Q7", "Q8", "Q9", "Q10", "Q11", "Q12", "Q13", "Q14", "Q15", "Q16", "Q17", "Q18", "Q19", "Q20", "Q21", "Q22", "Q23", "Q24", "Q25", "Q26", "Q27", "Q28", "Q29", "Q30", "Q31", "Q32", "Q33", "Q34", "Q35", "Q36", "Q37", "Q38", "Q39", "Q40", "Q41", "Q42", "Q43")
options$covariates <- list()
options$seed <- 1
options$emIterations <- 2000
set.seed(1)
results <- runAnalysis("itemResponseTheoryDichotomous", "binary.csv", options)

test_that("Additional Fit Statistics table results match", {
  table <- results[["results"]][["tableFitStatistics"]][["data"]]
  jaspTools::expect_equal_tables(
    table,
    list(1, 0, 0, 0.0818463254789198, 1.00404235150786, 0.0302405369235064)
  )
})

test_that("Item Information table results match", {
  table <- results[["results"]][["tableItemStatistics"]][["data"]]
  jaspTools::expect_equal_tables(
    table,
    list(
      -0.869664653014684, 0.94532528033347, 12, "Q1", 0.156418267087339,
      0.0640336225870714, 16.8219584702292, 0.388617852546313, 1.27299108391692,
      11, "Q2", 0.151171362151157, 0.066290471904318, 15.7371919451904,
      -0.548911558463101, 1.38745871848425, 10, "Q3", 0.889234522591553,
      0, 5.0289682568312, -1.25267373261882, 1.78029452138176, 6,
      "Q4", 0.251496147466259, 0.055653482320963, 7.82121833553644,
      1.03893330377888, 0.804572377482666, 13, "Q5", 0.950360058579825,
      0, 5.8814824160321, -0.221865385345531, 1.02504272427258, 12,
      "Q6", 0.788392718173705, 0, 7.95814350993942, -0.987514860120384,
      0.94024980233007, 12, "Q7", 0.10523803048115, 0.0735300691131746,
      18.358245171015, -0.647289131628655, 1.19389319955456, 10, "Q8",
      0.64208246672256, 0, 7.86437726211801, -0.114737551782435, 1.20897587111771,
      12, "Q9", 0.472459348699493, 0, 11.6708934279801, -0.627714347604557,
      1.40958906102336, 10, "Q10", 0.124897718947887, 0.072851362047544,
      15.2011745331387, 0.0161480032198886, 1.06852024036944, 12,
      "Q11", 0.495280198609335, 0, 11.3964797703058, -0.0677499742604382,
      1.39747855440464, 10, "Q12", 0.0780616249984216, 0.0835224134876041,
      16.8364736836984, -1.2091904612897, 1.27632382819341, 10, "Q13",
      0.14262185381503, 0.0693972330888265, 14.7196564411772, -0.951928327849875,
      1.38000635564821, 9, "Q14", 0.856317442168392, 0, 4.74050045625229,
      -2.23503066335157, 0.745741842230959, 9, "Q15", 0.481967464790867,
      0, 8.5276360175893, -1.29946414783244, 1.31433700110309, 10,
      "Q16", 0.420192594868023, 0.0154587708488097, 10.2341941242329,
      -0.0385434780809325, 0.629020064994879, 16, "Q17", 0.21702605899716,
      0.0509558474064203, 20.0713094675332, -0.491137533257672, 1.09726496521388,
      11, "Q18", 0.59233595024316, 0, 9.32048858031269, -0.0713010676316227,
      1.23669014934947, 12, "Q19", 0.837006652422082, 0, 7.30230328223271,
      0.273155713059602, 1.49844407049102, 11, "Q20", 0.509577960089283,
      0, 10.2327813732103, 0.0087561496675737, 1.5050549384016, 11,
      "Q21", 0.438378565327995, 0.00736425254821574, 11.0584623284102,
      -0.404121679970672, 0.602506080026915, 16, "Q22", 0.230460905256686,
      0.0490756220590309, 19.776397354994, -0.0900047745851928, 0.814712602007106,
      13, "Q23", 0.29459466007637, 0.0416236196700183, 15.2072377601893,
      1.45925385641978, 0.397196207365224, 16, "Q24", 0.497792477383483,
      0, 15.3690551203306, -0.808333194142597, 2.1115660562161, 8,
      "Q25", 0.00519859649955312, 0.132919823357704, 21.8514606820914,
      -0.350192159381665, 1.09944621210461, 12, "Q26", 0.637985743985986,
      0, 9.74882147878582, -0.20108639018095, 1.20159195282212, 11,
      "Q27", 0.177823721307436, 0.0616948224216261, 15.1031387004996,
      0.0949596298805748, 0.675545688353099, 14, "Q28", 0.410736839212259,
      0.0197271283209875, 14.5339269599396, 0.0555364432708519, 1.21952040286154,
      12, "Q29", 0.487543742673023, 0, 11.4889532493198, 1.25669029862903,
      1.03782040532587, 10, "Q30", 0.555679657909373, 0, 8.75315278740472,
      0.468596745502261, 0.719321245423033, 14, "Q31", 0.562675261219729,
      0, 12.5443216044603, 0.452273821336449, 2.17248336751987, 10,
      "Q32", 0.507304679819624, 0, 9.26336949980518, -0.23802213196878,
      0.923493833784515, 13, "Q33", 0.13141204325684, 0.0671187280102622,
      18.7392727297376, -1.19130396628384, 0.4972546648553, 13, "Q34",
      0.744916999864439, 0, 9.36416997704058, -0.166258219214997,
      1.10203808798623, 12, "Q35", 0.228838820308986, 0.0524480974839261,
      15.2349442453077, -0.268667384180661, 1.03262358712103, 11,
      "Q36", 0.74715664493861, 0, 7.61687622735072, -1.81037333879558,
      0.581924912007474, 12, "Q37", 0.152502901818512, 0.0647034332750822,
      16.9233643104376, -1.09830889268489, 0.880609398799014, 12,
      "Q38", 0.746152731061834, 0, 8.48526312903067, -1.46928404296605,
      1.54450876078383, 6, "Q39", 0.51243347957044, 0, 5.24790263829617,
      2.06035779998544, 1.11222727794497, 7, "Q40", 0.221942734061458,
      0.0597611415486971, 9.44997631089354, 2.33086403191615, 0.747704970168046,
      8, "Q41", 0.0205979629934837, 0.113417627459557, 18.085029643347,
      1.62841675030777, 0.476610275047386, 15, "Q42", 0.331305812439274,
      0.0349377980952661, 16.794355111546, 0.296080894477597, 1.06843851081766,
      13, "Q43", 0.299798013923747, 0.0408121061493168, 15.1220100826291
    )
  )
})

test_that("Model Summary table results match", {
  table <- results[["results"]][["tableSummary"]][["data"]]
  jaspTools::expect_equal_tables(
    table,
    list(
      4967.35233603525, 5190.53264314683, 860, 43, 851.578318909234,
      99, 0.574421588620654
    )
  )
})

# Consistency test 4, file: binary2.csv, model: 2pl ############################

options <- initIRTOptions("itemResponseTheoryDichotomous")
options$explanatoryText <- FALSE
options$emTolerance <- 0.0001
options$tableFitStatistics <- TRUE
options$tableFitStatisticsCI <- 0.95
options$tableItemStatistics <- TRUE
options$tableParameterEstimates <- FALSE
options$plotHistogramAbility <- TRUE
options$plotTestInformation <- TRUE
options$plotItemInformationItems <- c("Q1", "Q2", "Q3", "Q4", "Q5", "Q6", "Q7", "Q8", "Q9", "Q10", "Q11", "Q12", "Q13", "Q14", "Q15", "Q16", "Q17", "Q18", "Q19", "Q20")
options$plotItemInformationLabels <- FALSE
options$plotItemCharacteristicItems <- c("Q1", "Q2", "Q3", "Q4", "Q5", "Q6", "Q7", "Q8", "Q9", "Q10", "Q11", "Q12", "Q13", "Q14", "Q15", "Q16", "Q17", "Q18", "Q19", "Q20")
options$plotItemCharacteristicGroup <- TRUE
options$plotItemCharacteristicLabels <- FALSE
options$plotPriorPosterior <- FALSE
options$plotPriorPosteriorLabels <- FALSE
options$model <- "2PL"
options$items <- c("Q1", "Q2", "Q3", "Q4", "Q5", "Q6", "Q7", "Q8", "Q9", "Q10", "Q11", "Q12", "Q13", "Q14", "Q15", "Q16", "Q17", "Q18", "Q19", "Q20")
options$covariates <- list()
options$seed <- 1
options$emIterations <- 2000
set.seed(1)
results <- runAnalysis("itemResponseTheoryDichotomous", "binary2.csv", options)

test_that("Additional Fit Statistics table results match", {
  table <- results[["results"]][["tableFitStatistics"]][["data"]]
  jaspTools::expect_equal_tables(
    table,
    list(1, 0, 0, 0.115024811223627, 1.16786129927248, 0.0499391748353061)
  )
})

test_that("Item Information table results match", {
  table <- results[["results"]][["tableItemStatistics"]][["data"]]
  jaspTools::expect_equal_tables(
    table,
    list(
      -3.10385561914754, 0.467022288325445, 4, "Q1", 0.341485356784006,
      0.0509585980742232, 4.50896862866728, -0.237401897430613, 1.29883693588468,
      6, "Q2", 0.658061417388951, 0, 4.13760061458737, 0.231483288234357,
      1.55568295428904, 4, "Q3", 0.15395152030414, 0.116876438555339,
      6.67737997031845, 0.962640865109928, 0.16765532742725, 9, "Q4",
      0.282647144595925, 0.0656330419425417, 10.8996940218325, -0.160510859648724,
      2.64077849999494, 4, "Q5", 0.327522404000101, 0.056650379541701,
      4.62901603843488, -1.64369419715988, 0.622427172350289, 5, "Q6",
      0.0257267216719548, 0.177979313766031, 12.7607758515136, -0.487851241837239,
      0.337438948928775, 8, "Q7", 0.432068882753791, 0.00605198212288754,
      8.01435758314537, 2.2693386874977, 0.484798975179954, 4, "Q8",
      0.429313178566394, 0, 3.83133465907753, -3.89776824924517, 0.599797116126233,
      1, "Q9", 0.83902538526359, 0, 0.0412659753710641, 2.3743195164306,
      0.245876598212312, 7, "Q10", 0.269377145568605, 0.0718937667437538,
      8.77286879793561, -0.492011473383348, 0.977657203267912, 6,
      "Q11", 0.100103350462708, 0.12565004296405, 10.6416523892791,
      0.125166926851937, 5.7372116529371, 2, "Q12", 0.206539139462546,
      0.108539971682785, 3.15453069438418, 1.53635062431276, 0.387949606324379,
      7, "Q13", 0.0293375363452792, 0.158077559462032, 15.571060578277,
      -1.53104754589059, 0.327838258972259, 7, "Q14", 0.545211396510364,
      0, 5.95331173239924, -0.849599413800769, 2.49218080682413, 2,
      "Q15", 0.0833318874129596, 0.174082082503148, 4.96984800196603,
      -0.718098055839539, 1.15590819155372, 5, "Q16", 0.26318942792461,
      0.0774421815236341, 6.46933641238918, 1.30605651591458, 0.542269249391305,
      7, "Q17", 0.342959343677768, 0.0507585791191692, 7.88371664048956,
      0.00442282364969351, 0.866886976054996, 6, "Q18", 0.834854595812724,
      0, 2.78875716404555, -3.43433478840597, 0.118453192222847, 8,
      "Q19", 0.237593598969464, 0.0783650884630655, 10.407306139211,
      -1.20526041595877, 0.34585542000903, 7, "Q20", 0.527191228178107,
      0, 6.10804955940819
    )
  )
})

test_that("Model Summary table results match", {
  table <- results[["results"]][["tableSummary"]][["data"]]
  jaspTools::expect_equal_tables(
    table,
    list(
      1254.98755949428, 1331.46847971141, 170, 20, 152.92555735523,
      50, 0.82185815172317
    )
  )
})

# Consistency test 5, file: binary.csv, model: 3pl #############################

options <- initIRTOptions("itemResponseTheoryDichotomous")
options$explanatoryText <- FALSE
options$emTolerance <- 0.0001
options$tableFitStatistics <- TRUE
options$tableFitStatisticsCI <- 0.95
options$tableItemStatistics <- TRUE
options$tableParameterEstimates <- FALSE
options$plotHistogramAbility <- TRUE
options$plotTestInformation <- TRUE
options$plotItemInformationItems <- c("Q1", "Q2", "Q3", "Q4", "Q5", "Q6", "Q7", "Q8", "Q9", "Q10", "Q11", "Q12", "Q13", "Q14", "Q15", "Q16", "Q17", "Q18", "Q19", "Q20", "Q21", "Q22", "Q23", "Q24", "Q25", "Q26", "Q27", "Q28", "Q29", "Q30", "Q31", "Q32", "Q33", "Q34", "Q35", "Q36", "Q37", "Q38", "Q39", "Q40", "Q41", "Q42", "Q43")
options$plotItemInformationLabels <- FALSE
options$plotItemCharacteristicItems <- c("Q1", "Q2", "Q3", "Q4", "Q5", "Q6", "Q7", "Q8", "Q9", "Q10", "Q11", "Q12", "Q13", "Q14", "Q15", "Q16", "Q17", "Q18", "Q19", "Q20", "Q21", "Q22", "Q23", "Q24", "Q25", "Q26", "Q27", "Q28", "Q29", "Q30", "Q31", "Q32", "Q33", "Q34", "Q35", "Q36", "Q37", "Q38", "Q39", "Q40", "Q41", "Q42", "Q43")
options$plotItemCharacteristicGroup <- TRUE
options$plotItemCharacteristicLabels <- FALSE
options$plotPriorPosterior <- FALSE
options$plotPriorPosteriorLabels <- FALSE
options$model <- "3PL"
options$items <- c("Q1", "Q2", "Q3", "Q4", "Q5", "Q6", "Q7", "Q8", "Q9", "Q10", "Q11", "Q12", "Q13", "Q14", "Q15", "Q16", "Q17", "Q18", "Q19", "Q20", "Q21", "Q22", "Q23", "Q24", "Q25", "Q26", "Q27", "Q28", "Q29", "Q30", "Q31", "Q32", "Q33", "Q34", "Q35", "Q36", "Q37", "Q38", "Q39", "Q40", "Q41", "Q42", "Q43")
options$covariates <- list()
options$seed <- 1
options$emIterations <- 2000
set.seed(1)
results <- runAnalysis("itemResponseTheoryDichotomous", "binary.csv", options)

test_that("Additional Fit Statistics table results match", {
  table <- results[["results"]][["tableFitStatistics"]][["data"]]
  jaspTools::expect_equal_tables(
    table,
    list(1, 0, 0, 0.0833339210298208, 1.0103183493226, 0.027825297834717)
  )
})

test_that("Item Information table results match", {
  table <- results[["results"]][["tableItemStatistics"]][["data"]]
  jaspTools::expect_equal_tables(
    table,
    list(
      -0.822365384462536, 0.983517024426673, 7.83532599891485e-05, 10,
      "Q1", 0.090944945644073, 0.0802781679390105, 16.3156925626911,
      0.673634990825409, 3.8324919358648, 0.190159382629931, 11, "Q2",
      0.34191968347655, 0.0346528745554557, 12.2944858087227, -0.487705645419006,
      1.48644670951592, 7.38217920660411e-05, 9, "Q3", 0.606679697486699,
      0, 7.29264483504003, -1.30307499380081, 1.62310100554303, 0.000124309131957461,
      4, "Q4", 0.296475590788871, 0.0482268466934455, 4.91172486686129,
      0.993345803252396, 0.867742465424456, 7.1198363519725e-05, 12,
      "Q5", 0.941132174167828, 0, 5.45257554955914, 0.33115057734653,
      2.50157115648146, 0.239586284963643, 9, "Q6", 0.64385684074848,
      0, 6.93528826745808, -0.970278015130253, 0.93639834204628, 0.000262649692697635,
      10, "Q7", 0.0358712939293229, 0.0977521738772195, 19.3643777477677,
      0.130649603166654, 2.1932867995676, 0.329951092964425, 10, "Q8",
      0.502442155340383, 0, 9.31554224335359, -0.0746753480055552,
      1.27010748308519, 0.000174521540785117, 9, "Q9", 0.538405572899967,
      0, 7.95778952612516, -0.386755745543905, 1.53985997476057, 0.111366647580369,
      9, "Q10", 0.0998894689389001, 0.0803010189168288, 14.6873597096693,
      0.0475877274515108, 1.08128662117983, 0.000729789228805579,
      12, "Q11", 0.447165077219748, 0, 11.9815182895192, -0.0239206057205033,
      1.46234479183366, 2.82538519590979e-05, 9, "Q12", 0.109332542677535,
      0.0781241698541416, 14.3831863773817, -0.00762738362910346,
      4.84204200651543, 0.50091428755427, 8, "Q13", 0.447486195109647,
      0, 7.85776427668631, -0.939172877632437, 1.34628953081157, 0.000309626394975653,
      9, "Q14", 0.802001892891165, 0, 5.35852845089982, -0.219182559698798,
      1.27054212151096, 0.586495904848776, 8, "Q15", 0.399975491618453,
      0.0211526383261715, 8.35078834079573, -1.31302299090934, 1.26810898427554,
      0.00177147973151249, 8, "Q16", 0.175256592421711, 0.0667563803624928,
      11.4938288261758, 1.08628964208006, 1.56749823000905, 0.357646442649297,
      15, "Q17", 0.292977580648069, 0.0407813432991816, 17.44478340309,
      -0.472789071585726, 1.06056351202253, 0.00055447973322561, 10,
      "Q18", 0.501081280723278, 0, 9.33017803349236, 0.197432734970083,
      1.59468017731645, 0.111471746121578, 11, "Q19", 0.767689930469467,
      0, 7.378100471616, 0.611982055836062, 4.00943148251853, 0.196381351489981,
      11, "Q20", 0.594147415940305, 0, 9.30081315275938, 0.0564031345277119,
      1.76794209848983, 6.27451706780004e-05, 9, "Q21", 0.289814648577678,
      0.0451493985752019, 10.7979289450816, 0.703616476104781, 1.18130759485552,
      0.321807793462964, 15, "Q22", 0.17786428719768, 0.0574244287793133,
      19.8474205803267, -0.0644056856993675, 0.855567178729669, 0.00012712266725921,
      13, "Q23", 0.343016309102356, 0.033721948921884, 14.4487543750009,
      1.40564980418005, 0.415719218622805, 0.000114347551244241, 15,
      "Q24", 0.517084727482892, 0, 14.1115707983734, 0.0397513827318276,
      17.4046783676303, 0.449277756446141, 7, "Q25", 0.00268885324962972,
      0.147163806493283, 21.8568295559325, -0.308570254151761, 1.14584640610255,
      5.62881280347064e-05, 10, "Q26", 0.471158382737396, 0, 9.65617169064368,
      0.399641675093694, 2.29724042649626, 0.26462197187524, 10, "Q27",
      0.213453828535658, 0.057018332022997, 13.186068382951, 0.112499222271885,
      0.670566357226761, 0.000372029421330588, 13, "Q28", 0.357719931620531,
      0.0310954592954752, 14.2318657481268, 0.7266147514961, 25.1814781237045,
      0.345558185975184, 12, "Q29", 0.292394985820027, 0.0425726544588724,
      14.1314187474253, 1.22699358782749, 2.91738870551718, 0.134967995768126,
      8, "Q30", 0.343089247294851, 0.035546096722867, 8.99060359390943,
      0.456375650179061, 0.781116403527897, 0.000249681559714657,
      14, "Q31", 0.66976934975195, 0, 11.2061667205483, 0.494799412645422,
      2.18693409560457, 1.63657808283151e-05, 9, "Q32", 0.459775765832883,
      0, 8.7593782992354, -0.211985274683573, 0.923025966028431, 0.000519125850982151,
      12, "Q33", 0.113283610507191, 0.0719030540415907, 18.0799778362773,
      0.75482487671867, 1.04613468781347, 0.444195218426891, 11, "Q34",
      0.610945930126359, 0, 9.11859958521505, 0.626615363624738, 29.2776704823864,
      0.38572711349972, 12, "Q35", 0.630668238893112, 0, 9.83232142426301,
      -0.226052377597363, 1.09951854735162, 0.00041391609456384, 10,
      "Q36", 0.523309779475919, 0, 9.09290599679643, -0.496614831187162,
      0.807324569818364, 0.335162843423081, 11, "Q37", 0.10857134786701,
      0.0744587352489038, 16.9765433087459, -1.11951905664924, 0.842368016813431,
      0.000220868710185751, 11, "Q38", 0.639186222585925, 0, 8.81259073909933,
      -1.44633705674752, 1.50532256443748, 0.0385591293719194, 4,
      "Q39", 0.479902177121307, 0, 3.48670879599502, 1.79882353674495,
      2.10339280205272, 0.0576068177047712, 5, "Q40", 0.137785930320618,
      0.0827311632981214, 8.35377823652361, 2.02864752121137, 0.887797972817535,
      2.07647911416025e-05, 7, "Q41", 0.0136932593588685, 0.124552501256403,
      17.6421413404892, 1.70821955950284, 0.454199640060826, 0.000121375040395375,
      15, "Q42", 0.190891362437893, 0.0554861832867342, 19.5257133075217,
      0.31928695644735, 1.09413103760085, 6.66932643015294e-05, 12,
      "Q43", 0.37213381294102, 0.0285349196097795, 12.9575481652726
    )
  )
})

test_that("Model Summary table results match", {
  table <- results[["results"]][["tableSummary"]][["data"]]
  jaspTools::expect_equal_tables(
    table,
    list(
      5018.37999317659, 5353.15045384396, 817, 43, 796.577987008626,
      99, 0.688977693844765
    )
  )
})

# Consistency test 6, file: binary2.csv, model: 3pl ############################

options <- initIRTOptions("itemResponseTheoryDichotomous")
options$explanatoryText <- FALSE
options$emTolerance <- 0.0001
options$tableFitStatistics <- TRUE
options$tableFitStatisticsCI <- 0.95
options$tableItemStatistics <- TRUE
options$tableParameterEstimates <- FALSE
options$plotHistogramAbility <- TRUE
options$plotTestInformation <- TRUE
options$plotItemInformationItems <- c("Q1", "Q2", "Q3", "Q4", "Q5", "Q6", "Q7", "Q8", "Q9", "Q10", "Q11", "Q12", "Q13", "Q14", "Q15", "Q16", "Q17", "Q18", "Q19", "Q20")
options$plotItemInformationLabels <- FALSE
options$plotItemCharacteristicItems <- c("Q1", "Q2", "Q3", "Q4", "Q5", "Q6", "Q7", "Q8", "Q9", "Q10", "Q11", "Q12", "Q13", "Q14", "Q15", "Q16", "Q17", "Q18", "Q19", "Q20")
options$plotItemCharacteristicGroup <- TRUE
options$plotItemCharacteristicLabels <- FALSE
options$plotPriorPosterior <- FALSE
options$plotPriorPosteriorLabels <- FALSE
options$model <- "3PL"
options$items <- c("Q1", "Q2", "Q3", "Q4", "Q5", "Q6", "Q7", "Q8", "Q9", "Q10", "Q11", "Q12", "Q13", "Q14", "Q15", "Q16", "Q17", "Q18", "Q19", "Q20")
options$covariates <- list()
options$seed <- 1
options$emIterations <- 2000
set.seed(1)
results <- runAnalysis("itemResponseTheoryDichotomous", "binary2.csv", options)

test_that("Additional Fit Statistics table results match", {
  table <- results[["results"]][["tableFitStatistics"]][["data"]]
  jaspTools::expect_equal_tables(
    table,
    list(1, 0, 0, 0.111230365038294, 1.35077081882947, 0.00950758255271947)
  )
})

test_that("Item Information table results match", {
  skip("Does not reproduce")
  table <- results[["results"]][["tableItemStatistics"]][["data"]]
  jaspTools::expect_equal_tables(
    table,
    list(
      -0.146892433065302, 0.966537456966073, 0.572756657002018, 3, "Q1",
      0.259072196423997, 0.0833908839461425, 4.02224381022189, -0.262805762661129,
      1.08006381097532, 4.64027613238988e-05, 5, "Q2", 0.475911300865684,
      0, 4.52976189979313, 0.236305982035246, 1.59764762846641, 3.30864463301996e-05,
      3, "Q3", 0.0890857493010215, 0.154626386480568, 6.51466995121757,
      1.69966705721332, 18.1557768739952, 0.437576807156044, 8, "Q4",
      0.331386230867123, 0.0537082285142825, 9.13075293357582, -0.136424003163538,
      2.90755760465753, 1.5944319228692e-05, 3, "Q5", 0.178477773691323,
      0.113999300050998, 4.91038854058126, -1.6466451714284, 0.619708242585515,
      0.000376786933550902, 4, "Q6", 0.0125604302825832, 0.211296937374358,
      12.7506935657815, -0.682935786101285, 0.232626069961233, 0.00164360414964464,
      8, "Q7", 0.262403229209318, 0.0720952413950247, 10.0375077420683,
      2.22075151022514, 0.848981838681522, 0.119880190877167, 3, "Q8",
      0.360820026756083, 0.0375113925930117, 3.20684437241726, 0.290962170296299,
      30.3625821165254, 0.836423855548854, 0, "Q9", "NaN", "NaN",
      "NaN", 1.79592099632069, 2.2632431400451, 0.308105409359825,
      6, "Q10", 0.19648887833553, 0.0942898595525247, 8.61382981864384,
      0.035160849246651, 1.42575957118616, 0.207154450879904, 5, "Q11",
      0.0536612152256213, 0.155015237614538, 10.8872823537094, 0.136823006246252,
      6.53860672379508, 1.50966750461797e-05, 1, "Q12", 0.0631596570946981,
      0.223716697439183, 3.45240887494166, 1.38226464329981, 17.8790386663263,
      0.308838974807598, 5, "Q13", 0.013307976014119, 0.195781162490918,
      14.3909145786423, 1.20280587643497, 12.7512343351675, 0.575483975867749,
      6, "Q14", 0.528328366889789, 0, 5.12148984511239, -0.814481089574208,
      2.65101347845542, 8.36491706087968e-05, 1, "Q15", 0.0284177862739553,
      0.278572948538991, 4.80254149522766, -0.684218095177725, 1.21647219585552,
      0.00101900468356004, 4, "Q16", 0.163574409292424, 0.113375020528978,
      6.51936347486943, 1.17496306222254, 0.613919655899343, 8.6680728646815e-05,
      6, "Q17", 0.212260971030603, 0.0897754373619475, 8.36953097113751,
      0.0101183469886922, 0.916412382185355, 7.38348043348495e-05,
      5, "Q18", 0.71799171101759, 0, 2.88317032170923, 1.0140257667306,
      16.222396135675, 0.532176823808941, 6, "Q19", 0.192831473258365,
      0.0953479688895243, 8.67282314037916, -1.27146807761978, 0.265313040300518,
      0.0425122528370684, 6, "Q20", 0.334641908089458, 0.0538689411032895,
      6.85314766778336
    )
  )
})

test_that("Model Summary table results match", {
  table <- results[["results"]][["tableSummary"]][["data"]]
  jaspTools::expect_equal_tables(
    table,
    list(
      1285.47751357448, 1400.19889390017, 150, 20, 118.518040926432,
      50, 0.972811719760418
    )
  )
})

# Consistency test 7, file: binary.csv, model: 4pl #############################

options <- initIRTOptions("itemResponseTheoryDichotomous")
options$explanatoryText <- FALSE
options$emTolerance <- 0.0001
options$tableFitStatistics <- TRUE
options$tableFitStatisticsCI <- 0.95
options$tableItemStatistics <- TRUE
options$tableParameterEstimates <- FALSE
options$plotHistogramAbility <- TRUE
options$plotTestInformation <- TRUE
options$plotItemInformationItems <- c("Q1", "Q2", "Q3", "Q4", "Q5", "Q6", "Q7", "Q8", "Q9", "Q10", "Q11", "Q12", "Q13", "Q14", "Q15", "Q16", "Q17", "Q18", "Q19", "Q20", "Q21", "Q22", "Q23", "Q24", "Q25", "Q26", "Q27", "Q28", "Q29", "Q30", "Q31", "Q32", "Q33", "Q34", "Q35", "Q36", "Q37", "Q38", "Q39", "Q40", "Q41", "Q42", "Q43")
options$plotItemInformationLabels <- FALSE
options$plotItemCharacteristicItems <- c("Q1", "Q2", "Q3", "Q4", "Q5", "Q6", "Q7", "Q8", "Q9", "Q10", "Q11", "Q12", "Q13", "Q14", "Q15", "Q16", "Q17", "Q18", "Q19", "Q20", "Q21", "Q22", "Q23", "Q24", "Q25", "Q26", "Q27", "Q28", "Q29", "Q30", "Q31", "Q32", "Q33", "Q34", "Q35", "Q36", "Q37", "Q38", "Q39", "Q40", "Q41", "Q42", "Q43")
options$plotItemCharacteristicGroup <- TRUE
options$plotItemCharacteristicLabels <- FALSE
options$plotPriorPosterior <- FALSE
options$plotPriorPosteriorLabels <- FALSE
options$model <- "4PL"
options$items <- c("Q1", "Q2", "Q3", "Q4", "Q5", "Q6", "Q7", "Q8", "Q9", "Q10", "Q11", "Q12", "Q13", "Q14", "Q15", "Q16", "Q17", "Q18", "Q19", "Q20", "Q21", "Q22", "Q23", "Q24", "Q25", "Q26", "Q27", "Q28", "Q29", "Q30", "Q31", "Q32", "Q33", "Q34", "Q35", "Q36", "Q37", "Q38", "Q39", "Q40", "Q41", "Q42", "Q43")
options$covariates <- list()
options$seed <- 1
options$emIterations <- 2000
set.seed(1)
results <- runAnalysis("itemResponseTheoryDichotomous", "binary.csv", options)

test_that("Additional Fit Statistics table results match", {
  table <- results[["results"]][["tableFitStatistics"]][["data"]]
  jaspTools::expect_equal_tables(
    table,
    list(
      0.98375731218997, 0, 0.0216432481076691, 0.085586584365144, 0.981050197554965,
      0.0398710232516883
    )
  )
})

test_that("Item Information table results match", {
  skip("Does not reproduce")
  table <- results[["results"]][["tableItemStatistics"]][["data"]]
  jaspTools::expect_equal_tables(
    table,
    list(
      -1.19527109795163, 2.04619158162465, 2.5220064614277e-05, 0.801797418085518,
      9, "Q1", 0.107821448541665, 0.0784651594713966, 14.4302810632688,
      0.502345325561257, 7.48587947573003, 0.196181268458914, 0.915942734642142,
      9, "Q2", 0.341947538977795, 0.035416390622188, 10.1063108791884,
      -0.464175586640837, 1.63227499798451, 2.7247495620994e-05, 0.999987354894002,
      8, "Q3", 0.652172558093341, 0, 5.9558939168857, -1.27217989214561,
      1.62615743377799, 3.83213017457169e-05, 0.999994290888759, 5,
      "Q4", 0.0269654078055508, 0.124890793950572, 12.6428781026661,
      0.127087264332577, 1.17772151567555, 2.84751369256861e-05, 0.680576088262359,
      11, "Q5", 0.864949484016329, 0, 6.12420690406739, -0.0268762114327477,
      38.3823877823373, 0.22417673125628, 0.843632295327953, 7, "Q6",
      0.116100685584575, 0.0815037835437645, 11.5570065781169, -0.96660344520661,
      0.930436225215547, 6.26828067276669e-05, 0.999929407203298,
      10, "Q7", 0.0732552793009962, 0.0848193804240173, 17.0504407496039,
      -0.270327631973072, 1.67255877889699, 0.150382548592529, 0.99999152573859,
      8, "Q8", 0.541137682351863, 0, 6.95830683376766, -0.0779703629280668,
      1.36175872309365, 1.80048606530954e-05, 0.999972153042357, 10,
      "Q9", 0.32266732487472, 0.0386254661967642, 11.462088106139,
      -0.338585658900348, 50.2261829044935, 0.245195406117604, 0.856459551465303,
      8, "Q10", 0.104891303469399, 0.0815035454763116, 13.207977093364,
      -0.0424617240303241, 2.31852264434542, 0.130486625260352, 0.831525871668328,
      10, "Q11", 0.329675069620358, 0.0373435209083218, 11.3666477827537,
      -0.453059127756062, 3.53636449818669, 3.69001524036654e-05,
      0.755422973594255, 9, "Q12", 0.237190223407606, 0.0542291184259228,
      11.5937832055929, -0.151996474596934, 43.1314526947603, 0.500855802174386,
      0.976015212942748, 6, "Q13", 0.234663644381016, 0.0590057653607826,
      8.0472280433373, -0.292876565891354, 5.91127326047833, 0.38365638384334,
      0.922226593600642, 8, "Q14", 0.780808129047748, 0, 4.78002201559293,
      -0.209242589787073, 5.06297250794574, 0.624905028525748, 0.948561598569412,
      8, "Q15", 0.398038320030851, 0.0217709853702402, 8.37159703032911,
      -1.23252177604441, 1.36813594264538, 5.60047693805664e-05, 0.999985725012489,
      7, "Q16", 0.151982175013299, 0.0734974161785791, 10.7056829468601,
      -0.0191631222390125, 0.5427969382993, 0.000664756123774943,
      0.999496657398871, 14, "Q17", 0.265903010265378, 0.0453355790567453,
      16.8198918073791, -0.668236732907446, 1.51274456484405, 3.23519909738716e-05,
      0.888749209232099, 9, "Q18", 0.42863291876986, 0.0103295252481675,
      9.09410859901393, 0.351981835033319, 2.05937381576462, 0.201909127820686,
      0.999974193500102, 10, "Q19", 0.585267706038353, 0, 8.44692800977408,
      0.499471392721254, 1.9421487239134, 0.111163984285872, 0.999982189122762,
      10, "Q20", 0.642868470207492, 0, 7.85632585959849, -0.129869946766355,
      54.8489001615127, 0.0964554477880284, 0.82033421641952, 6, "Q21",
      0.0615383445401122, 0.101178076685031, 12.0193578825891, -0.305422634856035,
      58.8721396289606, 0.322789992473999, 0.670188743420129, 11,
      "Q22", 0.273094258843689, 0.0463639985190529, 13.3172907466514,
      -0.509187480620718, 36.6253988111661, 0.165157579871558, 0.637162342804259,
      13, "Q23", 0.340192879760382, 0.0342105820518844, 14.4910436395948,
      -0.88448667073611, 46.7818108398618, 6.89155741561197e-06, 0.429484214777094,
      13, "Q24", 0.320301153385475, 0.0375398067089922, 14.7953680497916,
      -0.762731284880245, 2.08100639384741, 7.24949781159518e-05,
      0.999996228844147, 6, "Q25", 0.00179322711927094, 0.160012454925397,
      21.0551436099763, -0.57029399227146, 1.75779492688776, 2.01126329920667e-05,
      0.85829633474832, 9, "Q26", 0.318187375401103, 0.0400084641140115,
      10.4117972910722, 0.46340519624631, 2.79679976949229, 0.311951195932706,
      0.99999051618735, 11, "Q27", 0.0698580686828222, 0.0836352347879286,
      18.5404509928784, 0.674056258242842, 0.809671175677051, 0.16186118972384,
      0.999479443275233, 13, "Q28", 0.0627354054289184, 0.081922464230349,
      21.5501836454598, 0.70770836043022, 39.0644650888215, 0.338273154884913,
      0.999993255628656, 12, "Q29", 0.226752707188049, 0.0527699898527411,
      15.2747740709727, 1.07979601018867, 27.5633614462627, 0.157522047510369,
      0.870422147913979, 7, "Q30", 0.0794628994758363, 0.0912442138389618,
      12.7112974995359, -0.34911853680878, 3.98478622560886, 0.0868103328836352,
      0.60709608523356, 12, "Q31", 0.60574588475898, 0, 10.1164423630037,
      0.459204517818275, 2.27113818696339, 5.57667055476308e-06, 0.999945937247103,
      8, "Q32", 0.3590996565507, 0.0320235004868963, 8.80399559341245,
      -0.0985507195458111, 54.8027227956632, 0.277674565287057, 0.766323149857726,
      9, "Q33", 0.14035824559973, 0.071605962994274, 13.5223790918495,
      0.755499606865486, 1.18575187575389, 0.454915206172935, 0.999940938066897,
      11, "Q34", 0.515874249943479, 0, 10.1620283642173, 0.614357167013484,
      33.0995487592598, 0.384736945889682, 0.999995713888664, 11,
      "Q35", 0.489859975929551, 0, 10.45639996732, -0.389456895303074,
      1.3590334280243, 3.15438072110859e-05, 0.919275251505518, 10,
      "Q36", 0.564014705556634, 0, 8.66654570295417, -2.08160603869119,
      0.711820220135184, 0.0110871106621568, 0.911345740439862, 10,
      "Q37", 0.0735333994380835, 0.0847428526196845, 17.0377240487191,
      -1.00302252758323, 0.957658617105512, 7.97227975265606e-05,
      0.999974711099736, 9, "Q38", 0.568504246264531, 0, 7.66229104522188,
      -0.891283584665222, 45.8267684938382, 0.236782917962859, 0.947067347144437,
      2, "Q39", 0.166593791212624, 0.0899090707084935, 3.58439363515032,
      1.68088465456798, 23.4634823616382, 0.080329403618657, 0.999935321373809,
      4, "Q40", 0.251746927155155, 0.0590347713323183, 5.36616085669357,
      -0.294345394070301, 53.8310967894179, 2.78186103973457e-06,
      0.256493456441306, 5, "Q41", 0.0203183582073595, 0.130533070644443,
      13.3490524406149, -0.887222195838198, 43.1906355172925, 9.83995824156112e-06,
      0.381785082491502, 13, "Q42", 0.116786353468516, 0.0698072749837657,
      19.2082728861997, -0.760059709721915, 3.51500449671219, 2.2485182907563e-05,
      0.557790100899884, 12, "Q43", 0.204854690745366, 0.0561716276790103,
      15.7105760651846
    )
  )
})

test_that("Model Summary table results match", {
  table <- results[["results"]][["tableSummary"]][["data"]]
  jaspTools::expect_equal_tables(
    table,
    list(
      5043.38262785775, 5489.7432420809, 774, 43, 809.531366669489,
      99, 0.182335226584902
    )
  )
})

# Consistency test 8, file: binary2.csv, model: 4pl ############################

options <- initIRTOptions("itemResponseTheoryDichotomous")
options$explanatoryText <- FALSE
options$emTolerance <- 0.0001
options$tableFitStatistics <- TRUE
options$tableFitStatisticsCI <- 0.95
options$tableItemStatistics <- TRUE
options$tableParameterEstimates <- FALSE
options$plotHistogramAbility <- TRUE
options$plotTestInformation <- TRUE
options$plotItemInformationItems <- c("Q1", "Q2", "Q3", "Q4", "Q5", "Q6", "Q7", "Q8", "Q9", "Q10", "Q11", "Q12", "Q13", "Q14", "Q15", "Q16", "Q17", "Q18", "Q19", "Q20")
options$plotItemInformationLabels <- FALSE
options$plotItemCharacteristicItems <- c("Q1", "Q2", "Q3", "Q4", "Q5", "Q6", "Q7", "Q8", "Q9", "Q10", "Q11", "Q12", "Q13", "Q14", "Q15", "Q16", "Q17", "Q18", "Q19", "Q20")
options$plotItemCharacteristicGroup <- TRUE
options$plotItemCharacteristicLabels <- FALSE
options$plotPriorPosterior <- FALSE
options$plotPriorPosteriorLabels <- FALSE
options$model <- "4PL"
options$items <- c("Q1", "Q2", "Q3", "Q4", "Q5", "Q6", "Q7", "Q8", "Q9", "Q10", "Q11", "Q12", "Q13", "Q14", "Q15", "Q16", "Q17", "Q18", "Q19", "Q20")
options$covariates <- list()
options$seed <- 1
options$emIterations <- 2000
set.seed(1)
results <- runAnalysis("itemResponseTheoryDichotomous", "binary2.csv", options)

test_that("Additional Fit Statistics table results match", {
  table <- results[["results"]][["tableFitStatistics"]][["data"]]
  jaspTools::expect_equal_tables(
    table,
    list(1, 0, 0, 0.121783878630401, 1.03417613059298, 0.0724239954937869)
  )
})

test_that("Item Information table results match", {
  skip("Does not reproduce")
  table <- results[["results"]][["tableItemStatistics"]][["data"]]
  jaspTools::expect_equal_tables(
    table,
    list(
      -0.516835524880631, 53.7270974237299, 0.54330127446293, 0.905562878878879,
      1, "Q1", 0.171546745293163, 0.13320035689766, 1.86937441880553,
      -0.483634424921032, 2.89324076176843, 1.35617485090429e-05,
      0.839124676547814, 3, "Q2", 0.613879851865128, 0, 1.80485109801346,
      -0.125519327534892, 2.2704513886206, 1.38257395791751e-05, 0.807843803810123,
      2, "Q3", 0.038688769618147, 0.214390731971354, 6.50441182361087,
      -1.70478505206717, 47.5997732699023, 3.7672523013978e-07, 0.487199441083752,
      7, "Q4", 0.175057711448606, 0.0972803893662705, 10.2459716352518,
      -0.390864725575515, 4.74648336311153, 3.79461196663932e-06,
      0.85898062645667, 3, "Q5", 0.115040291932619, 0.141192999630874,
      5.93051308228031, -1.4407492000014, 26.2388498589184, 8.66469352473149e-06,
      0.783263159338693, 3, "Q6", 0.0064386849885902, 0.251455234758274,
      12.2947710578388, -1.70250141205652, 47.5624974656754, 9.06429062560076e-06,
      0.572004967206708, 6, "Q7", 0.36875694362495, 0.0415644081759424,
      6.50791440794281, 0.725658216975978, 29.8121111634672, 0.128425495824532,
      0.680527728005031, 1, "Q8", 0.112216234882306, 0.17628414978652,
      2.52272897183185, 0.135486863634035, 40.1651008940763, 0.81629017447498,
      0.999998345390905, 0, "Q9", "NaN", "NaN", "NaN", 1.36087039203878,
      27.9793013466495, 0.296974746246249, 0.999951998075809, 4, "Q10",
      0.0976014163253728, 0.139978702139172, 7.84043126230315, -0.450185615366541,
      1.09821912682485, 2.4992248199532e-05, 0.999974196628347, 5,
      "Q11", 0.0677443444715244, 0.146767478719353, 10.2774697383608,
      -0.126697459395523, 48.1840139012519, 1.70716457304508e-06,
      0.842539972030721, 1, "Q12", 0.166070757820103, 0.136879160058736,
      1.91805931846087, 1.09715969713165, 19.2921409978608, 0.258160960434399,
      0.999991805290512, 3, "Q13", 0.0605618945668149, 0.172732549380883,
      7.38597044149601, -0.102444002134771, 52.266688354266, 0.490546496005589,
      0.728526926663286, 5, "Q14", 0.411616498623333, 0.0119624296047381,
      5.03505943190184, -0.791548360903507, 3.06489189950315, 7.04539422760357e-06,
      0.999994849375535, 0, "Q15", "NaN", "NaN", "NaN", -0.706333128433553,
      25.3107601123175, 0.26843645895447, 0.772288129528126, 3, "Q16",
      0.173442854919768, 0.115988084289606, 4.9776256474844, -0.811295686041314,
      35.9011180427978, 3.39583958652081e-06, 0.42141086589777, 5,
      "Q17", 0.0567203017110647, 0.153104046797252, 10.7430080406953,
      -0.476268589817363, 51.5975507083229, 0.0913612345996084, 0.669774420807043,
      3, "Q18", 0.361038286194402, 0.0373734950590482, 3.20532638554052,
      0.728581625761746, 34.9771933719655, 0.474522175234437, 0.999993442139624,
      5, "Q19", 0.227598094401548, 0.0882406202813509, 6.9076697315712,
      -1.70073949549541, 47.7875332834881, 9.03504068594659e-06, 0.635572684443006,
      6, "Q20", 0.143313034640576, 0.110406094043093, 9.58371464694456
    )
  )
})

test_that("Model Summary table results match", {
  table <- results[["results"]][["tableSummary"]][["data"]]
  jaspTools::expect_equal_tables(
    table,
    list(
      1298.71683449539, 1451.67867492964, 130, 20, 127.341643160483,
      50, 0.549568309984869
    )
  )
})

################################################################################
